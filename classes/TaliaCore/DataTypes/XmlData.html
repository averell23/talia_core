<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: TaliaCore::DataTypes::XmlData</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">TaliaCore::DataTypes::XmlData</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/talia_core/data_types/xml_data_rb.html">
                lib/talia_core/data_types/xml_data.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="FileRecord.html">
                FileRecord
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="FileRecord.html">FileRecord</a> class to store XML (or XHTML)
files.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000216">create_from_data</a>&nbsp;&nbsp;
      <a href="#M000211">extract_mime_type</a>&nbsp;&nbsp;
      <a href="#M000213">get_content</a>&nbsp;&nbsp;
      <a href="#M000214">get_content_string</a>&nbsp;&nbsp;
      <a href="#M000215">get_escaped_content_string</a>&nbsp;&nbsp;
      <a href="#M000212">mime_subtype</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000216" class="method-detail">
        <a name="M000216"></a>

        <div class="method-heading">
          <a href="#M000216" class="method-signature">
          <span class="method-name">create_from_data</span><span class="method-args">(location, data, options = {:tidy =&gt; true})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See the <a href="FileStore.html">FileStore</a> module for details on how
creation of data file objects works. This version differs from the
superclass version in that it will (optionally) clean the HTML using the
&quot;tidy&quot; tool. Also see <a
href="http://tidy.rubyforge.org">tidy.rubyforge.org</a>/
</p>
<p>
Tidy will be used under the following circumstances:
</p>
<ul>
<li>The &quot;tidy&quot; option is given and

</li>
<li>The library itself is available and

</li>
<li>The file appears to be a (X)HTML file

</li>
</ul>
<p>
*Options:*:
</p>
<dl>
<dt><b>tidy</b></dt><dd>Use the &quot;tidy&quot; tool to clean up (X)HTML. Defaults to true if no
options are given.

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000216-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000216-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_core/data_types/xml_data.rb, line 120</span>
120:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_from_data</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:tidy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>})
121:         <span class="ruby-comment cmt"># check tidy option</span>
122:         <span class="ruby-keyword kw">if</span> (((<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:tidy</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-constant">Tidy_enable</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>)) <span class="ruby-keyword kw">and</span> 
123:               ((<span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">location</span>) <span class="ruby-operator">==</span> <span class="ruby-value str">'.htm'</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">location</span>) <span class="ruby-operator">==</span> <span class="ruby-value str">'.html'</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">location</span>) <span class="ruby-operator">==</span> <span class="ruby-value str">'.xhtml'</span>)))        
124:         
125:           <span class="ruby-comment cmt"># apply tidy on data</span>
126:           <span class="ruby-identifier">data_to_write</span> = <span class="ruby-constant">Tidy</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">:show_warnings</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tidy</span><span class="ruby-operator">|</span>
127:             <span class="ruby-identifier">tidy</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">output_xhtml</span> = <span class="ruby-keyword kw">true</span>
128:             <span class="ruby-identifier">tidy</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">tidy_mark</span> = <span class="ruby-keyword kw">false</span>
129:             <span class="ruby-identifier">xhtml</span> = <span class="ruby-identifier">tidy</span>.<span class="ruby-identifier">clean</span>(<span class="ruby-identifier">data</span>)
130:             <span class="ruby-identifier">xhtml</span>
131:           <span class="ruby-keyword kw">end</span>
132:         <span class="ruby-keyword kw">else</span>
133:           <span class="ruby-identifier">data_to_write</span> = <span class="ruby-identifier">data</span>
134:         <span class="ruby-keyword kw">end</span>
135:       
136:         <span class="ruby-comment cmt"># write data</span>
137:         <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">data_to_write</span>, <span class="ruby-identifier">options</span>)
138:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000211" class="method-detail">
        <a name="M000211"></a>

        <div class="method-heading">
          <a href="#M000211" class="method-signature">
          <span class="method-name">extract_mime_type</span><span class="method-args">(location)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
MIME type should be one of &#8216;text/html&#8217; or
&#8216;text/xml&#8217; (&#8216;text/hnml&#8217; is supported for legacy
reasons)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000211-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000211-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/xml_data.rb, line 37</span>
37:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extract_mime_type</span>(<span class="ruby-identifier">location</span>)
38:         <span class="ruby-comment cmt"># TODO: Could probably use the Mime classes to get the</span>
39:         <span class="ruby-comment cmt"># type, or move to the superclass</span>
40:         <span class="ruby-keyword kw">case</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">location</span>).<span class="ruby-identifier">downcase</span>
41:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'.htm'</span>, <span class="ruby-value str">'.html'</span>,<span class="ruby-value str">'.xhtml'</span>
42:           <span class="ruby-value str">'text/html'</span>
43:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'.hnml'</span>
44:           <span class="ruby-value str">'text/hnml'</span>
45:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'.xml'</span>
46:           <span class="ruby-value str">'text/xml'</span>
47:         <span class="ruby-keyword kw">end</span>
48:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000213" class="method-detail">
        <a name="M000213"></a>

        <div class="method-heading">
          <a href="#M000213" class="method-signature">
          <span class="method-name">get_content</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The content of this document. This returns REXML elements for the document
content. For plain XML files, this will return the children of the doucment
root. For XHTML documents, this will return the children of the
&quot;body&quot; tag.
</p>
<p>
<b>Options</b>:
</p>
<ul>
<li>[<b>xsl_file</b>] If given, the document will be transformed using this

<pre>
             XSL file before the document is extracted
</pre>
</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000213-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000213-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/xml_data.rb, line 64</span>
64:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_content</span>(<span class="ruby-identifier">options</span> = {})
65:         <span class="ruby-comment cmt"># TODO: Maybe port this to hpricot/nokogiri too</span>
66:         <span class="ruby-identifier">text_to_parse</span> = <span class="ruby-identifier">all_text</span>
67:       
68:         <span class="ruby-comment cmt"># if xsl_file option is specified, execute transformation</span>
69:         <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:xsl_file</span>])
70:           <span class="ruby-identifier">text_to_parse</span> = <span class="ruby-identifier">xslt_transform</span>(<span class="ruby-identifier">file_path</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:xsl_file</span>])
71:         <span class="ruby-keyword kw">end</span>
72: 
73:         <span class="ruby-comment cmt"># create document object</span>
74:         <span class="ruby-identifier">document</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">text_to_parse</span>
75:       
76:         <span class="ruby-comment cmt"># get content</span>
77:         <span class="ruby-keyword kw">if</span> ((<span class="ruby-identifier">mime_subtype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;html&quot;</span>) <span class="ruby-keyword kw">or</span> 
78:               ((<span class="ruby-identifier">mime_subtype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;xml&quot;</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">options</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:xsl_file</span>].<span class="ruby-identifier">nil?</span>)))
79:           <span class="ruby-identifier">content</span> = <span class="ruby-identifier">document</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-value str">'//body'</span>].<span class="ruby-identifier">elements</span>
80:         <span class="ruby-keyword kw">elsif</span> ((<span class="ruby-identifier">mime_subtype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;xml&quot;</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">mime_subtype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;hnml&quot;</span>))
81:           <span class="ruby-identifier">content</span> = <span class="ruby-identifier">document</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">elements</span>
82:         <span class="ruby-keyword kw">end</span>
83:       
84:         <span class="ruby-comment cmt"># adjust/replace items path</span>
85:         <span class="ruby-identifier">content</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">wrapItem</span> <span class="ruby-identifier">i</span> }
86:       
87:         <span class="ruby-comment cmt"># return content</span>
88:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">content</span>
89:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000214" class="method-detail">
        <a name="M000214"></a>

        <div class="method-heading">
          <a href="#M000214" class="method-signature">
          <span class="method-name">get_content_string</span><span class="method-args">(options = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Same as <a href="XmlData.html#M000213">get_content</a>, but returns a
string instead of the REXML documents
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000214-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000214-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/xml_data.rb, line 92</span>
92:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_content_string</span>(<span class="ruby-identifier">options</span> = <span class="ruby-keyword kw">nil</span>)
93:         <span class="ruby-identifier">xml_str</span> = <span class="ruby-value str">''</span>
94:         <span class="ruby-identifier">get_content</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span>
95:           <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">to_s</span>
96:         <span class="ruby-keyword kw">end</span>
97:         <span class="ruby-identifier">xml_str</span>
98:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000215" class="method-detail">
        <a name="M000215"></a>

        <div class="method-heading">
          <a href="#M000215" class="method-signature">
          <span class="method-name">get_escaped_content_string</span><span class="method-args">(options = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Same as <a href="XmlData.html#M000214">get_content_string</a>, but with the
XML escape for inclusion in HTML documents
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000215-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000215-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_core/data_types/xml_data.rb, line 102</span>
102:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_escaped_content_string</span>(<span class="ruby-identifier">options</span> = <span class="ruby-keyword kw">nil</span>)
103:         <span class="ruby-identifier">get_content_string</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/&lt;/</span>, <span class="ruby-value str">&quot;&amp;lt;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/&gt;/</span>, <span class="ruby-value str">&quot;&amp;gt;&quot;</span>)
104:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000212" class="method-detail">
        <a name="M000212"></a>

        <div class="method-heading">
          <a href="#M000212" class="method-signature">
          <span class="method-name">mime_subtype</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The mime subtype for this specified class
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000212-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000212-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/xml_data.rb, line 51</span>
51:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mime_subtype</span>
52:         <span class="ruby-identifier">mime_type</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\//</span>)[<span class="ruby-value">1</span>]
53:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>