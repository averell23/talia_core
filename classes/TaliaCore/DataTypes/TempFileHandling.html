<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: TaliaCore::DataTypes::TempFileHandling</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">TaliaCore::DataTypes::TempFileHandling</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/talia_core/data_types/temp_file_handling_rb.html">
                lib/talia_core/data_types/temp_file_handling.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Module for the handling of temporary files in data storage objects
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000151">copy_to_temp_file</a>&nbsp;&nbsp;
      <a href="#M000153">random_tempfile_filename</a>&nbsp;&nbsp;
      <a href="#M000149">temp_data</a>&nbsp;&nbsp;
      <a href="#M000150">temp_data=</a>&nbsp;&nbsp;
      <a href="#M000146">temp_path</a>&nbsp;&nbsp;
      <a href="#M000148">temp_path=</a>&nbsp;&nbsp;
      <a href="#M000147">temp_paths</a>&nbsp;&nbsp;
      <a href="#M000152">write_to_temp_file</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Module <a href="TempFileHandling/ClassMethods.html" class="link">TaliaCore::DataTypes::TempFileHandling::ClassMethods</a><br />

    </div>




      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000151" class="method-detail">
        <a name="M000151"></a>

        <div class="method-heading">
          <a href="#M000151" class="method-signature">
          <span class="method-name">copy_to_temp_file</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Copies the given file to a randomly named Tempfile.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000151-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000151-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/temp_file_handling.rb, line 69</span>
69:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_to_temp_file</span>(<span class="ruby-identifier">file</span>)
70:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">copy_to_temp_file</span> <span class="ruby-identifier">file</span>, <span class="ruby-identifier">random_tempfile_filename</span>
71:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000153" class="method-detail">
        <a name="M000153"></a>

        <div class="method-heading">
          <a href="#M000153" class="method-signature">
          <span class="method-name">random_tempfile_filename</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generates a unique filename for a Tempfile.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000153-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000153-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/temp_file_handling.rb, line 79</span>
79:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">random_tempfile_filename</span>
80:         <span class="ruby-node">&quot;#{rand Time.now.to_i}#{location || 'attachment'}&quot;</span>
81:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000149" class="method-detail">
        <a name="M000149"></a>

        <div class="method-heading">
          <a href="#M000149" class="method-signature">
          <span class="method-name">temp_data</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gets the data from the latest temp file. This will read the file into
memory.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000149-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000149-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/temp_file_handling.rb, line 59</span>
59:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">temp_data</span>
60:         <span class="ruby-identifier">save_attachment?</span> <span class="ruby-value">? </span><span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">temp_path</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
61:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000150" class="method-detail">
        <a name="M000150"></a>

        <div class="method-heading">
          <a href="#M000150" class="method-signature">
          <span class="method-name">temp_data=</span><span class="method-args">(data)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes the given data to a Tempfile and adds it to the collection of temp
files.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000150-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000150-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/temp_file_handling.rb, line 64</span>
64:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">temp_data=</span>(<span class="ruby-identifier">data</span>)
65:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">temp_path</span> = <span class="ruby-identifier">write_to_temp_file</span> <span class="ruby-identifier">data</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">nil?</span>
66:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000146" class="method-detail">
        <a name="M000146"></a>

        <div class="method-heading">
          <a href="#M000146" class="method-signature">
          <span class="method-name">temp_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gets the latest temp path from the collection of temp paths. While working
with an attachment, multiple Tempfile objects may be created for various
processing purposes (resizing, for example). An array of all the tempfile
objects is stored so that the Tempfile instance is held on to until
it&#8216;s not needed anymore. The collection is cleared after saving the
attachment.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000146-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000146-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/temp_file_handling.rb, line 40</span>
40:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">temp_path</span>
41:         <span class="ruby-identifier">p</span> = <span class="ruby-identifier">temp_paths</span>.<span class="ruby-identifier">first</span>
42:         <span class="ruby-identifier">p</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:path</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">path</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">to_s</span>
43:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000148" class="method-detail">
        <a name="M000148"></a>

        <div class="method-heading">
          <a href="#M000148" class="method-signature">
          <span class="method-name">temp_path=</span><span class="method-args">(value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a new <a href="TempFileHandling.html#M000146">temp_path</a> to the
array. This should take a string or a Tempfile. This class makes no attempt
to remove the files, so Tempfiles should be used. Tempfiles remove
themselves when they go out of scope. You can also use string paths for
temporary files, such as those used for uploaded files in a web server.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000148-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000148-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/temp_file_handling.rb, line 53</span>
53:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">temp_path=</span>(<span class="ruby-identifier">value</span>)
54:         <span class="ruby-identifier">temp_paths</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">value</span>
55:         <span class="ruby-identifier">temp_path</span>
56:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000147" class="method-detail">
        <a name="M000147"></a>

        <div class="method-heading">
          <a href="#M000147" class="method-signature">
          <span class="method-name">temp_paths</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gets an array of the currently used temp paths. Defaults to a copy of
full_filename.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000147-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000147-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/temp_file_handling.rb, line 46</span>
46:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">temp_paths</span>
47:         <span class="ruby-ivar">@temp_paths</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">full_filename</span>)) <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> [<span class="ruby-identifier">copy_to_temp_file</span>(<span class="ruby-identifier">full_filename</span>)]
48:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000152" class="method-detail">
        <a name="M000152"></a>

        <div class="method-heading">
          <a href="#M000152" class="method-signature">
          <span class="method-name">write_to_temp_file</span><span class="method-args">(data)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes the given file to a randomly named Tempfile.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000152-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000152-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/data_types/temp_file_handling.rb, line 74</span>
74:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_to_temp_file</span>(<span class="ruby-identifier">data</span>)
75:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">write_to_temp_file</span> <span class="ruby-identifier">data</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">location</span>
76:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>