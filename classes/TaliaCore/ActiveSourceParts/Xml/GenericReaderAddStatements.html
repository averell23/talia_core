<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: TaliaCore::ActiveSourceParts::Xml::GenericReaderAddStatements</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">TaliaCore::ActiveSourceParts::Xml::GenericReaderAddStatements</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../../files/lib/talia_core/active_source_parts/xml/generic_reader_add_statements_rb.html">
                lib/talia_core/active_source_parts/xml/generic_reader_add_statements.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
These are statements that can be used in handlers (see <a
href="GenericReaderImportStatements.html">GenericReaderImportStatements</a>
to learn about handlers). They will <a
href="GenericReaderAddStatements.html#M000101">add</a> data to the source
that is currently being imported.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000101">add</a>&nbsp;&nbsp;
      <a href="#M000103">add_date</a>&nbsp;&nbsp;
      <a href="#M000104">add_date_interval</a>&nbsp;&nbsp;
      <a href="#M000106">add_file</a>&nbsp;&nbsp;
      <a href="#M000102">add_i18n</a>&nbsp;&nbsp;
      <a href="#M000105">add_rel</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000101" class="method-detail">
        <a name="M000101"></a>

        <div class="method-heading">
          <a href="#M000101" class="method-signature">
          <span class="method-name">add</span><span class="method-args">(predicate, object, required = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a value for the given predicate (may also be a database field).
Example:
</p>
<pre>
 add :uri, &quot;http://foobar.org&quot; # Set the uri of the current source to http://foobar.org
 add 'dct:creator', ['John Doe', 'Jane Doe'] # Sets the dct:creator property
</pre>
<p>
To <a href="GenericReaderAddStatements.html#M000101">add</a> relations
between source, see <a
href="GenericReaderAddStatements.html#M000105">add_rel</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000101-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000101-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/xml/generic_reader_add_statements.rb, line 16</span>
16:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">required</span> = <span class="ruby-keyword kw">false</span>)
17:           <span class="ruby-comment cmt"># We need to check if the object elements are already strings -</span>
18:           <span class="ruby-comment cmt"># otherwise we would *.to_s the PropertyString objects, which would</span>
19:           <span class="ruby-comment cmt"># destroy the metadata in them.</span>
20:           <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">object</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>))
21:             <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">set_element</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">obj</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">required</span>) }
22:           <span class="ruby-keyword kw">else</span>
23:             <span class="ruby-identifier">set_element</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">object</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">required</span>)
24:           <span class="ruby-keyword kw">end</span>
25:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000103" class="method-detail">
        <a name="M000103"></a>

        <div class="method-heading">
          <a href="#M000103" class="method-signature">
          <span class="method-name">add_date</span><span class="method-args">(predicate, date, required = false, fmt = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a date field. This will attempt to parse the original string and write
the result as an ISO 8061 compliant date string. Note that this won&#8216;t
be able to parse everything you throw at it, though.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000103-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000103-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/xml/generic_reader_add_statements.rb, line 37</span>
37:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_date</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">date</span>, <span class="ruby-identifier">required</span> = <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">fmt</span> = <span class="ruby-keyword kw">nil</span>)
38:           <span class="ruby-identifier">add</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">to_iso8601</span>(<span class="ruby-identifier">parse_date</span>(<span class="ruby-identifier">date</span>, <span class="ruby-identifier">fmt</span>)), <span class="ruby-identifier">required</span>)
39:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="#M000104" class="method-signature">
          <span class="method-name">add_date_interval</span><span class="method-args">(predicate, start_date, end_date, fmt = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a date interval as an ISO 8061 compliant date string. See <a
href="GenericReaderAddStatements.html#M000103">add_date</a> for more info.
If only one of the dates is given this will <a
href="GenericReaderAddStatements.html#M000101">add</a> a normal date string
instead of an interval.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000104-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/xml/generic_reader_add_statements.rb, line 44</span>
44:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_date_interval</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span>, <span class="ruby-identifier">fmt</span> = <span class="ruby-keyword kw">nil</span>)
45:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">end_date</span>.<span class="ruby-identifier">blank?</span>)
46:           <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">blank?</span>)
47:             <span class="ruby-identifier">add_date</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">start_date</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">fmt</span>)
48:           <span class="ruby-keyword kw">elsif</span>(<span class="ruby-identifier">end_date</span>.<span class="ruby-identifier">blank?</span>)
49:             <span class="ruby-identifier">add_date</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">end_date</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">fmt</span>)
50:           <span class="ruby-keyword kw">else</span>
51:             <span class="ruby-identifier">add</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-node">&quot;#{to_iso8601(parse_date(start_date, fmt))}/#{to_iso8601(parse_date(end_date, fmt))}&quot;</span>, <span class="ruby-identifier">required</span>)
52:           <span class="ruby-keyword kw">end</span>
53:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">add_file</span><span class="method-args">(urls, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a file to the source being imported. See the DataLoader module for a
description of the possible options.
</p>
<p>
Note that the import reader will not be able to resolve URLs or file names
that are relative to the original XML file or URL. File names should be
absolute (otherwise they&#8216;ll be treated as relative to the current
Talia working directory), as should be URLs. Furthermore, the file
names/paths must be valid on the machine _where the import takes place_.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/xml/generic_reader_add_statements.rb, line 84</span>
84:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_file</span>(<span class="ruby-identifier">urls</span>, <span class="ruby-identifier">options</span> = {})
85:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">urls</span>.<span class="ruby-identifier">blank?</span>)
86:           <span class="ruby-identifier">urls</span> = [ <span class="ruby-identifier">urls</span> ] <span class="ruby-keyword kw">unless</span>(<span class="ruby-identifier">urls</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>))
87:           <span class="ruby-identifier">files</span> = <span class="ruby-identifier">urls</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">url</span><span class="ruby-operator">|</span> { <span class="ruby-identifier">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">get_absolute_file_url</span>(<span class="ruby-identifier">url</span>), <span class="ruby-identifier">:options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span> } }
88:           <span class="ruby-ivar">@current</span>.<span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:files</span>] = <span class="ruby-identifier">files</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">files</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)
89:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000102" class="method-detail">
        <a name="M000102"></a>

        <div class="method-heading">
          <a href="#M000102" class="method-signature">
          <span class="method-name">add_i18n</span><span class="method-args">(predicate, object, lang, type=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Works as <a href="GenericReaderAddStatements.html#M000101">add</a>, but
also encodes the language (and potentially the type of the literal) into
the value.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000102-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000102-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/xml/generic_reader_add_statements.rb, line 29</span>
29:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_i18n</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">lang</span>, <span class="ruby-identifier">type</span>=<span class="ruby-keyword kw">nil</span>)
30:           <span class="ruby-identifier">object</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">PropertyString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">lang</span>, <span class="ruby-identifier">type</span>)
31:           <span class="ruby-identifier">add</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">object</span>)
32:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">add_rel</span><span class="method-args">(predicate, object, required = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a relation for the given predicate. This works as <a
href="GenericReaderAddStatements.html#M000101">add</a>, but with the
difference that it takes an object uri instead of a literal value. (See the
<a href="GenericReaderAddStatements.html#M000101">add</a> method to <a
href="GenericReaderAddStatements.html#M000101">add</a> literal values):
</p>
<pre>
 add_rel 'dct:create', 'local:John', 'local:Jane'
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/xml/generic_reader_add_statements.rb, line 60</span>
60:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_rel</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">required</span> = <span class="ruby-keyword kw">false</span>)
61:           <span class="ruby-identifier">object</span> = <span class="ruby-identifier">check_objects</span>(<span class="ruby-identifier">object</span>)
62:           <span class="ruby-keyword kw">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">object</span>)
63:             <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Relation with empty object on #{predicate} (#{@current.attributes['uri']}).&quot;</span>) <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">required</span>)
64:             <span class="ruby-keyword kw">return</span>
65:           <span class="ruby-keyword kw">end</span>
66:           <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">object</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>))
67:             <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> 
68:               <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Cannot add relation on database field &lt;#{predicate}&gt; - &lt;#{object.inspect}&gt;&quot;</span>) <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">ActiveSource</span>.<span class="ruby-identifier">db_attr?</span>(<span class="ruby-identifier">predicate</span>))
69:               <span class="ruby-identifier">set_element</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-node">&quot;&lt;#{irify(obj)}&gt;&quot;</span>, <span class="ruby-identifier">required</span>) 
70:             <span class="ruby-keyword kw">end</span>
71:           <span class="ruby-keyword kw">else</span>
72:             <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;Cannot add relation on database field&quot;</span>) <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">ActiveSource</span>.<span class="ruby-identifier">db_attr?</span>(<span class="ruby-identifier">predicate</span>))
73:             <span class="ruby-identifier">set_element</span>(<span class="ruby-identifier">predicate</span>, <span class="ruby-node">&quot;&lt;#{irify(object)}&gt;&quot;</span>, <span class="ruby-identifier">required</span>)
74:           <span class="ruby-keyword kw">end</span>
75:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>