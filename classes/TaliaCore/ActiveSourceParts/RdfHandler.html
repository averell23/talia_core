<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: TaliaCore::ActiveSourceParts::RdfHandler</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">TaliaCore::ActiveSourceParts::RdfHandler</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/talia_core/active_source_parts/rdf_handler_rb.html">
                lib/talia_core/active_source_parts/rdf_handler.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Methods for the <a href="../ActiveSource.html">ActiveSource</a> class to
automatically create the RDF triples for a source and to access the RDF
data of the source.
</p>
<p>
The RDF for a source will be automatically created through the
auto_create_rdf callback when the source is set (and autosave_rdf is set)
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000084">autosave_rdf=</a>&nbsp;&nbsp;
      <a href="#M000083">autosave_rdf?</a>&nbsp;&nbsp;
      <a href="#M000086">create_rdf</a>&nbsp;&nbsp;
      <a href="#M000085">my_rdf</a>&nbsp;&nbsp;
      <a href="#M000087">to_rdf</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000084" class="method-detail">
        <a name="M000084"></a>

        <div class="method-heading">
          <a href="#M000084" class="method-signature">
          <span class="method-name">autosave_rdf=</span><span class="method-args">(value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This can be used to turn of automatic rdf creation. If set to true, <a
href="RdfHandler.html#M000086">create_rdf</a> will <b>not</b> be called
automatically after saving the source.
</p>
<p>
<b>Attention</b>: Improper use will compromise the integrity of the RDF
data. However, it may be used in order to speed up operations that save a
record several times and don&#8216;t need the RDF data in the meantime.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000084-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000084-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf_handler.rb, line 24</span>
24:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">autosave_rdf=</span>(<span class="ruby-identifier">value</span>)
25:         <span class="ruby-ivar">@autosave_rdf</span> = <span class="ruby-identifier">value</span>
26:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000083" class="method-detail">
        <a name="M000083"></a>

        <div class="method-heading">
          <a href="#M000083" class="method-signature">
          <span class="method-name">autosave_rdf?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the value of the autosave_rdf flag, as set by <a
href="RdfHandler.html#M000084">autosave_rdf=</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000083-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000083-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf_handler.rb, line 12</span>
12:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">autosave_rdf?</span>
13:         <span class="ruby-ivar">@autosave_rdf</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span>(<span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@autosave_rdf</span>))
14:         <span class="ruby-ivar">@autosave_rdf</span>
15:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000086" class="method-detail">
        <a name="M000086"></a>

        <div class="method-heading">
          <a href="#M000086" class="method-signature">
          <span class="method-name">create_rdf</span><span class="method-args">(force = :false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This creates the RDF subgraph for this <a href="../Source.html">Source</a>
and saves it to disk. This may be an expensive operation since it removes
the existing elements. (Could be optimised ;-)
</p>
<p>
Unless the force option is specified, this will ignore predicates that
remain unchanged. This means that writing will be faster if a predicate
will not changed, but if database objects were not added through the
standard API they&#8216;ll be missed
</p>
<p>
The force option may have three values:
</p>
<dl>
<dt><b>false</b></dt><dd>Normal operation. This retrieves the data for each of the cached
SemanticCollectionWrappers that may have been modified and rewrites the
respective attribute in the RDF store. (see the <a
href="PredicateHandler.html">PredicateHandler</a> module for an explanation
of the wrapper cache). It will ignore wrappers that are obviously
&quot;clean&quot;, but will do a &quot;retrieve and write&quot; for each
wrapper separately.

</dd>
<dt><b>force</b></dt><dd>Force a complete rewrite of the RDF data for this source. This will erase
the RDF and write all triples for this source in one go. It will also
remove any triples for this source that may have been added externally.

</dd>
<dt><b>create</b></dt><dd>Do not check for any existing data, just write out the data that is in the
cache. This is fast, but must <b>only</b> be used for new sources where it
is certain that no data for the source exists in the RDF store.

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000086-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000086-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf_handler.rb, line 64</span>
64:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_rdf</span>(<span class="ruby-identifier">force</span> = <span class="ruby-identifier">:false</span>)
65:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">benchmark</span>(<span class="ruby-value str">&quot;\033[32m\033[4m\033[1mActiveSource::RD\033[0m Creating RDF for source&quot;</span>, <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">DEBUG</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">do</span>
66:           <span class="ruby-identifier">assit</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">new_record?</span>, <span class="ruby-node">&quot;Record must exist here: #{self.uri}&quot;</span>)
67:           <span class="ruby-comment cmt"># Get the stuff to write. This will also erase the old data</span>
68:           
69:           <span class="ruby-identifier">s_rels</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">force</span> 
70:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:force</span> 
71:               <span class="ruby-identifier">prepare_all_predicates_to_write</span> 
72:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:create</span>
73:               <span class="ruby-identifier">prepare_predicates_to_create</span>
74:             <span class="ruby-keyword kw">else</span>
75:               <span class="ruby-identifier">prepare_predicates_to_write</span>
76:             <span class="ruby-keyword kw">end</span>
77:           <span class="ruby-identifier">s_rels</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sem_ref</span><span class="ruby-operator">|</span>
78:             <span class="ruby-comment cmt"># We pass the object on. If it's a SemanticProperty, we need to add</span>
79:             <span class="ruby-comment cmt"># the value. If not the RDF handler will detect the #uri method and</span>
80:             <span class="ruby-comment cmt"># will add it as Resource.</span>
81:             <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">sem_ref</span>.<span class="ruby-identifier">object</span>
82:             <span class="ruby-identifier">assit</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-node">&quot;Must have an object here. #{sem_ref.inspect}&quot;</span>)
83:             <span class="ruby-identifier">value</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SemanticProperty</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">obj</span>
84:             <span class="ruby-identifier">my_rdf</span>.<span class="ruby-identifier">direct_write_predicate</span>(<span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">URI</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sem_ref</span>.<span class="ruby-identifier">predicate_uri</span>), <span class="ruby-identifier">value</span>)
85:           <span class="ruby-keyword kw">end</span>
86:           <span class="ruby-identifier">my_rdf</span>.<span class="ruby-identifier">direct_write_predicate</span>(<span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">RDF</span>.<span class="ruby-identifier">type</span>, <span class="ruby-identifier">rdf_selftype</span>)
87:           <span class="ruby-identifier">my_rdf</span>.<span class="ruby-identifier">save</span>
88:         <span class="ruby-keyword kw">end</span>
89:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000085" class="method-detail">
        <a name="M000085"></a>

        <div class="method-heading">
          <a href="#M000085" class="method-signature">
          <span class="method-name">my_rdf</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the RDF object to use for this <a
href="../ActiveSource.html">ActiveSource</a>. This will return a <a
href="../RdfResource.html">RdfResource</a>, which has a similiar (but more
limited API) than the <a href="../ActiveSource.html">ActiveSource</a>
itself. All operations and queries on that resource will go to the RDF
store instead of the database
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000085-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000085-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf_handler.rb, line 33</span>
33:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">my_rdf</span>
34:         <span class="ruby-ivar">@rdf_resource</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
35:           <span class="ruby-identifier">src</span> = <span class="ruby-constant">RdfResource</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uri</span>)
36:           <span class="ruby-identifier">src</span>.<span class="ruby-identifier">object_class</span> = <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveSource</span>
37:           <span class="ruby-identifier">src</span>
38:         <span class="ruby-keyword kw">end</span>
39:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000087" class="method-detail">
        <a name="M000087"></a>

        <div class="method-heading">
          <a href="#M000087" class="method-signature">
          <span class="method-name">to_rdf</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates an RDF/XML resprentation of the source. See the <a
href="Xml/RdfBuilder.html">Xml::RdfBuilder</a> and the <a
href="Xml/SourceReader.html">Xml::SourceReader</a> for more information.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000087-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000087-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_core/active_source_parts/rdf_handler.rb, line 93</span>
 93:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_rdf</span>
 94:         <span class="ruby-identifier">rdf</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>
 95: 
 96:         <span class="ruby-constant">ActiveSourceParts</span><span class="ruby-operator">::</span><span class="ruby-constant">Xml</span><span class="ruby-operator">::</span><span class="ruby-constant">RdfBuilder</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">:target</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rdf</span>, <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">builder</span><span class="ruby-operator">|</span>
 97:           <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">write_source</span>(<span class="ruby-keyword kw">self</span>)
 98:         <span class="ruby-keyword kw">end</span>
 99: 
100:         <span class="ruby-identifier">rdf</span>
101:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>