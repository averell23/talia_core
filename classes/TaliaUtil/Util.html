<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: TaliaUtil::Util</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">TaliaUtil::Util</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/talia_util/util_rb.html">
                lib/talia_util/util.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Main utility functions for Talia
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000481">clear_data</a>&nbsp;&nbsp;
      <a href="#M000486">do_migrations</a>&nbsp;&nbsp;
      <a href="#M000489">fat_record_joins</a>&nbsp;&nbsp;
      <a href="#M000488">fat_record_select</a>&nbsp;&nbsp;
      <a href="#M000487">flag?</a>&nbsp;&nbsp;
      <a href="#M000479">flush_db</a>&nbsp;&nbsp;
      <a href="#M000480">flush_rdf</a>&nbsp;&nbsp;
      <a href="#M000482">full_reset</a>&nbsp;&nbsp;
      <a href="#M000473">get_files</a>&nbsp;&nbsp;
      <a href="#M000476">init_talia</a>&nbsp;&nbsp;
      <a href="#M000485">load_fixtures</a>&nbsp;&nbsp;
      <a href="#M000474">ontology_folder</a>&nbsp;&nbsp;
      <a href="#M000490">print_options</a>&nbsp;&nbsp;
      <a href="#M000484">rewrite_count</a>&nbsp;&nbsp;
      <a href="#M000483">rewrite_rdf</a>&nbsp;&nbsp;
      <a href="#M000475">setup_ontologies</a>&nbsp;&nbsp;
      <a href="#M000477">talia_config</a>&nbsp;&nbsp;
      <a href="#M000478">title</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000481" class="method-detail">
        <a name="M000481"></a>

        <div class="method-heading">
          <a href="#M000481" class="method-signature">
          <span class="method-name">clear_data</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove the data directories
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000481-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000481-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 108</span>
108:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear_data</span>
109:         <span class="ruby-identifier">data_dir</span> = <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'data_directory_location'</span>]
110:         <span class="ruby-identifier">iip_dir</span> = <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'iip_root_directory_location'</span>]
111:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-identifier">data_dir</span>) <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">data_dir</span>))
112:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-identifier">iip_dir</span>) <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">iip_dir</span>))
113:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000486" class="method-detail">
        <a name="M000486"></a>

        <div class="method-heading">
          <a href="#M000486" class="method-signature">
          <span class="method-name">do_migrations</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Do migrations
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000486-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000486-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 172</span>
172:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_migrations</span>
173:         <span class="ruby-identifier">migration_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;generators&quot;</span>, <span class="ruby-value str">&quot;talia&quot;</span>, <span class="ruby-value str">&quot;templates&quot;</span>, <span class="ruby-value str">&quot;migrations&quot;</span>)
174:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-identifier">migration_path</span>, <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;VERSION&quot;</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;VERSION&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span> )
175:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000489" class="method-detail">
        <a name="M000489"></a>

        <div class="method-heading">
          <a href="#M000489" class="method-signature">
          <span class="method-name">fat_record_joins</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Select semantic properties joined with all connected tables. TODO: Review
after merging with optimized branch
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000489-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000489-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 202</span>
202:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fat_record_joins</span>
203:         <span class="ruby-identifier">joins</span> =  <span class="ruby-value str">&quot; LEFT JOIN active_sources AS obj_sources ON semantic_relations.object_id = obj_sources.id AND semantic_relations.object_type = 'TaliaCore::ActiveSource'&quot;</span>
204:         <span class="ruby-identifier">joins</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; LEFT JOIN semantic_properties AS obj_props ON semantic_relations.object_id = obj_props.id AND semantic_relations.object_type = 'TaliaCore::SemanticProperty'&quot;</span>
205:         <span class="ruby-identifier">joins</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; LEFT JOIN active_sources AS subject_sources ON semantic_relations.subject_id = subject_sources.id&quot;</span>
206:         <span class="ruby-identifier">joins</span>
207:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000488" class="method-detail">
        <a name="M000488"></a>

        <div class="method-heading">
          <a href="#M000488" class="method-signature">
          <span class="method-name">fat_record_select</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
For selecting &quot;fat&quot; records on the semantic properties, including
the objects. Used for rewriting the rdf. TODO: Review after merging with
optimized branch
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000488-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000488-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 186</span>
186:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fat_record_select</span>
187:         <span class="ruby-identifier">select</span> = <span class="ruby-value str">'semantic_relations.id AS id, semantic_relations.created_at AS created_at, '</span>
188:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'semantic_relations.updated_at AS updated_at, '</span>
189:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'object_id, object_type, subject_id, predicate_uri, '</span>
190:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'obj_props.created_at AS property_created_at, '</span>
191:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'obj_props.updated_at AS property_updated_at, '</span>
192:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'obj_props.value AS property_value, '</span>
193:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'obj_sources.created_at AS object_created_at, '</span>
194:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'obj_sources.updated_at AS object_updated_at, obj_sources.type AS  object_realtype, '</span>
195:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'obj_sources.uri AS object_uri, '</span>
196:         <span class="ruby-identifier">select</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'subject_sources.uri AS subject_uri'</span>
197:         <span class="ruby-identifier">select</span>
198:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000487" class="method-detail">
        <a name="M000487"></a>

        <div class="method-heading">
          <a href="#M000487" class="method-signature">
          <span class="method-name">flag?</span><span class="method-args">(the_flag)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Check if the given flag is set on the command line
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000487-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000487-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 178</span>
178:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flag?</span>(<span class="ruby-identifier">the_flag</span>)
179:         <span class="ruby-identifier">assit_not_nil</span>(<span class="ruby-identifier">the_flag</span>)
180:         <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">the_flag</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">ENV</span>[<span class="ruby-identifier">the_flag</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;yes&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">the_flag</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;true&quot;</span>)
181:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000479" class="method-detail">
        <a name="M000479"></a>

        <div class="method-heading">
          <a href="#M000479" class="method-signature">
          <span class="method-name">flush_db</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Flush the database. This only flushes the main data tables!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000479-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000479-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 96</span>
 96:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flush_db</span>
 97:         [ <span class="ruby-value str">'active_sources'</span>, <span class="ruby-value str">'data_records'</span>, <span class="ruby-value str">'semantic_properties'</span>, <span class="ruby-value str">'semantic_relations'</span>, <span class="ruby-value str">'workflows'</span>].<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;DELETE FROM #{f}&quot;</span> }
 98:         <span class="ruby-comment cmt"># Also remove the &quot;unsaved cache&quot; for the wrappers (may be important during testing)</span>
 99:         <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">SemanticCollectionWrapper</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value str">'@unsaved_source_cache'</span><span class="ruby-value str">'@unsaved_source_cache'</span>, {})
100:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000480" class="method-detail">
        <a name="M000480"></a>

        <div class="method-heading">
          <a href="#M000480" class="method-signature">
          <span class="method-name">flush_rdf</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Flush the RDF store
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000480-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000480-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 103</span>
103:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flush_rdf</span>
104:         <span class="ruby-constant">ConnectionPool</span>.<span class="ruby-identifier">write_adapter</span>.<span class="ruby-identifier">clear</span>
105:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000482" class="method-detail">
        <a name="M000482"></a>

        <div class="method-heading">
          <a href="#M000482" class="method-signature">
          <span class="method-name">full_reset</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Do a full reset of the data store
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000482-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000482-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 117</span>
117:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">full_reset</span>
118:         <span class="ruby-identifier">flush_db</span>
119:         <span class="ruby-identifier">flush_rdf</span>
120:         <span class="ruby-identifier">clear_data</span>
121:         <span class="ruby-identifier">setup_ontologies</span>
122:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000473" class="method-detail">
        <a name="M000473"></a>

        <div class="method-heading">
          <a href="#M000473" class="method-signature">
          <span class="method-name">get_files</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the list of files from the &quot;files&quot; option
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000473-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000473-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 9</span>
 9:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_files</span>
10:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Files given: #{ENV['files']}&quot;</span>
11:         <span class="ruby-keyword kw">unless</span>(<span class="ruby-constant">ENV</span>[<span class="ruby-value str">'files'</span>])
12:           <span class="ruby-identifier">puts</span>(<span class="ruby-value str">&quot;This task needs files to work. Pass them like this files='something/*.x'&quot;</span>)
13:           <span class="ruby-identifier">print_options</span>
14:           <span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)
15:         <span class="ruby-keyword kw">end</span>
16:     
17:         <span class="ruby-constant">FileList</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ENV</span>[<span class="ruby-value str">'files'</span>])
18:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000476" class="method-detail">
        <a name="M000476"></a>

        <div class="method-heading">
          <a href="#M000476" class="method-signature">
          <span class="method-name">init_talia</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Init the talia core system
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000476-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000476-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 45</span>
45:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_talia</span>
46:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">Initializer</span>.<span class="ruby-identifier">initialized</span>)
47:     
48:         <span class="ruby-comment cmt"># If options are not set, the initializer will fall back to the internal default</span>
49:         <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">Initializer</span>.<span class="ruby-identifier">talia_root</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'talia_root'</span>]
50:         <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">Initializer</span>.<span class="ruby-identifier">environment</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'environment'</span>]
51:     
52:         <span class="ruby-identifier">config_file</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'config'</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'config'</span>] <span class="ruby-operator">:</span> <span class="ruby-value str">'talia_core'</span>
53:     
54:         <span class="ruby-comment cmt"># run the initializer</span>
55:         <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">Initializer</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">config_file</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">config</span><span class="ruby-operator">|</span>
56:           <span class="ruby-keyword kw">unless</span>(<span class="ruby-identifier">flag?</span>(<span class="ruby-value str">'no_standalone'</span>))
57:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Always using standalone db from utilities.&quot;</span>
58:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Give the no_standalone option to override it.&quot;</span>
59:             <span class="ruby-identifier">config</span>[<span class="ruby-value str">'standalone_db'</span>] = <span class="ruby-value str">&quot;true&quot;</span>
60:           <span class="ruby-keyword kw">end</span>
61:         <span class="ruby-keyword kw">end</span>
62:     
63:         <span class="ruby-identifier">puts</span>(<span class="ruby-value str">&quot;\nTaliaCore initialized&quot;</span>)
64:     
65:         <span class="ruby-comment cmt"># # Flush the database if requested</span>
66:         <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">flag?</span>(<span class="ruby-value str">'reset_db'</span>))
67:           <span class="ruby-identifier">flush_db</span>
68:           <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;DB flushed&quot;</span>
69:         <span class="ruby-keyword kw">end</span>
70:     
71:         <span class="ruby-comment cmt"># Flus the rdf if requested</span>
72:         <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">flag?</span>(<span class="ruby-value str">'reset_rdf'</span>))
73:           <span class="ruby-identifier">flush_rdf</span>
74:           <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;RDF flushed&quot;</span>
75:         <span class="ruby-keyword kw">end</span>
76:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000485" class="method-detail">
        <a name="M000485"></a>

        <div class="method-heading">
          <a href="#M000485" class="method-signature">
          <span class="method-name">load_fixtures</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Load the fixtures
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000485-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000485-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 162</span>
162:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_fixtures</span>
163:         <span class="ruby-comment cmt"># fixtures = ENV['FIXTURES'] ? ENV['FIXTURES'].split(/,/) : Dir.glob(File.join(File.dirname(__FILE__), 'test', 'fixtures', '*.{yml,csv}'))  </span>
164:         <span class="ruby-identifier">fixtures</span> = [ <span class="ruby-value str">'active_sources'</span>, <span class="ruby-value str">'semantic_relations'</span>, <span class="ruby-value str">'semantic_properties'</span> <span class="ruby-value str">'data_records'</span>]
165:         <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;DELETE FROM #{f}&quot;</span> }
166:         <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fixture_file</span><span class="ruby-operator">|</span>
167:           <span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">create_fixtures</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">'test'</span>, <span class="ruby-value str">'fixtures'</span>), <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">fixture_file</span>, <span class="ruby-value str">'.*'</span>))  
168:         <span class="ruby-keyword kw">end</span>  
169:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000474" class="method-detail">
        <a name="M000474"></a>

        <div class="method-heading">
          <a href="#M000474" class="method-signature">
          <span class="method-name">ontology_folder</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the configured folder for the ontologies
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000474-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000474-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 21</span>
21:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ontology_folder</span>
22:         <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'ontology_folder'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>, <span class="ruby-value str">'ontologies'</span>)
23:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000490" class="method-detail">
        <a name="M000490"></a>

        <div class="method-heading">
          <a href="#M000490" class="method-signature">
          <span class="method-name">print_options</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
print the common options for the tasks
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000490-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000490-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 210</span>
210:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">print_options</span>
211:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;\nGeneral options (not all options are valid for all tasks):&quot;</span>
212:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;files=&lt;pattern&gt;     - Files for the task (a pattern to match the files)&quot;</span>
213:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;talia_root=&lt;path&gt;   - Manually configure the TALIA_ROOT path&quot;</span>
214:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;                      (default:autodetect)&quot;</span>
215:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;reset_rdf={yes|no}  - Flush the RDF store (default:no)&quot;</span>
216:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;reset_db={yes|no}   - Flush the database (default:no)&quot;</span>
217:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;config=&lt;filename&gt;   - Talia configuration file (default: talia_core)&quot;</span>
218:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;environment=&lt;env&gt;   - Environment for configuration (default: development)&quot;</span>
219:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;data_dir=&lt;dir&gt;      - Directory for the data files&quot;</span>
220:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;verbose={yes|no}    - Show some additional info&quot;</span>
221:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;&quot;</span>
222:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000484" class="method-detail">
        <a name="M000484"></a>

        <div class="method-heading">
          <a href="#M000484" class="method-signature">
          <span class="method-name">rewrite_count</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This gives the number of triples that would be rewritten on <a
href="Util.html#M000483">rewrite_rdf</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000484-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000484-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 157</span>
157:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rewrite_count</span>
158:         <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">SemanticRelation</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">+</span> <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveSource</span>.<span class="ruby-identifier">count</span>
159:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000483" class="method-detail">
        <a name="M000483"></a>

        <div class="method-heading">
          <a href="#M000483" class="method-signature">
          <span class="method-name">rewrite_rdf</span><span class="method-args">() {|if(block_given?)| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Rewrite the RDF for the whole database. Will yield without parameters for
progress-reporting blocks. FIXME: At the moment, this looses all RDF data
that is not in the database.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000483-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000483-source">
<pre>
     <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 128</span>
128:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rewrite_rdf</span>
129:         <span class="ruby-identifier">flush_rdf</span>
130:         <span class="ruby-comment cmt"># We'll get all data from single query.</span>
131:         <span class="ruby-identifier">fat_rels</span> = <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">SemanticRelation</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fat_record_joins</span>,
132:           <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fat_record_select</span>)
133:         <span class="ruby-identifier">fat_rels</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rec</span><span class="ruby-operator">|</span>
134:           <span class="ruby-identifier">subject</span> = <span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">URI</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">rec</span>.<span class="ruby-identifier">subject_uri</span>)
135:           <span class="ruby-identifier">predicate</span> = <span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">URI</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">rec</span>.<span class="ruby-identifier">predicate_uri</span>)
136:           <span class="ruby-identifier">object</span> = <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">rec</span>.<span class="ruby-identifier">object_uri</span>)
137:             <span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">URI</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">rec</span>.<span class="ruby-identifier">object_uri</span>)
138:           <span class="ruby-keyword kw">else</span>
139:             <span class="ruby-identifier">rec</span>.<span class="ruby-identifier">property_value</span>
140:           <span class="ruby-keyword kw">end</span>
141:           <span class="ruby-constant">FederationManager</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">subject</span>, <span class="ruby-identifier">predicate</span>, <span class="ruby-identifier">object</span>)
142:           <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">block_given?</span>)
143:         <span class="ruby-keyword kw">end</span>
144: 
145:         <span class="ruby-comment cmt"># Rewriting all the &quot;runtime type&quot; rdf triples</span>
146:         <span class="ruby-comment cmt"># We'll select the type as something else, so that it doesn't try to do</span>
147:         <span class="ruby-comment cmt"># STI instantiation (which would cause this to blow for classes that</span>
148:         <span class="ruby-comment cmt"># are defined outside the core.</span>
149:         <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveSource</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'uri, type AS runtime_type'</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">src</span><span class="ruby-operator">|</span>
150:           <span class="ruby-identifier">type</span> = (<span class="ruby-identifier">src</span>.<span class="ruby-identifier">runtime_type</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'ActiveSource'</span>)
151:           <span class="ruby-constant">FederationManager</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">src</span>, <span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">RDF</span>.<span class="ruby-identifier">type</span>, <span class="ruby-constant">N</span><span class="ruby-operator">::</span><span class="ruby-constant">TALIA</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">type</span>)
152:           <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">block_given?</span>)
153:         <span class="ruby-keyword kw">end</span>
154:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000475" class="method-detail">
        <a name="M000475"></a>

        <div class="method-heading">
          <a href="#M000475" class="method-signature">
          <span class="method-name">setup_ontologies</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set up the ontologies from the given folder
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000475-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000475-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 26</span>
26:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_ontologies</span>
27:         <span class="ruby-comment cmt"># Clear the ontologies from RDF, if possible</span>
28:         <span class="ruby-identifier">adapter</span> = <span class="ruby-constant">ConnectionPool</span>.<span class="ruby-identifier">write_adapter</span>
29:         <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">supports_context?</span>)
30:           <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">RdfImport</span>.<span class="ruby-identifier">clear_file_contexts</span>
31:         <span class="ruby-keyword kw">else</span>
32:           <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;WARNING: Cannot remove old ontologies, adapter doesn't support contexts.&quot;</span>
33:         <span class="ruby-keyword kw">end</span>
34: 
35:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Ontologies loaded from: #{ontology_folder}&quot;</span>
36:         <span class="ruby-identifier">files</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">ontology_folder</span>, <span class="ruby-value str">'*.{rdf*,owl}'</span>)]
37:         <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'rdf_syntax'</span>] <span class="ruby-operator">||=</span> <span class="ruby-value str">'rdfxml'</span>
38:         <span class="ruby-identifier">params</span> = [<span class="ruby-constant">ENV</span>[<span class="ruby-value str">'rdf_syntax'</span>], <span class="ruby-identifier">files</span>]
39:         <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">:auto</span> <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">supports_context?</span>)
40:         <span class="ruby-constant">TaliaCore</span><span class="ruby-operator">::</span><span class="ruby-constant">RdfImport</span><span class="ruby-operator">::</span><span class="ruby-identifier">import</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>)
41:         <span class="ruby-constant">RdfUpdate</span><span class="ruby-operator">::</span><span class="ruby-identifier">owl_to_rdfs</span>
42:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000477" class="method-detail">
        <a name="M000477"></a>

        <div class="method-heading">
          <a href="#M000477" class="method-signature">
          <span class="method-name">talia_config</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get info from the Talia configuraion
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000477-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000477-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 79</span>
79:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">talia_config</span>
80:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Talia configuration&quot;</span>
81:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;&quot;</span>
82:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;TALIA_ROOT: #{TALIA_ROOT}&quot;</span>
83:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Environment: #{TaliaCore::CONFIG['environment']}&quot;</span>
84:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Standalone DB: #{TaliaCore::CONFIG['standalone_db']}&quot;</span>
85:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Data Directory: #{TaliaCore::CONFIG['data_directory_location']}&quot;</span>
86:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Local Domain: #{N::LOCAL}&quot;</span>
87:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000478" class="method-detail">
        <a name="M000478"></a>

        <div class="method-heading">
          <a href="#M000478" class="method-signature">
          <span class="method-name">title</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Put the <a href="Util.html#M000478">title</a> for Talia
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000478-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000478-source">
<pre>
    <span class="ruby-comment cmt"># File lib/talia_util/util.rb, line 90</span>
90:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">title</span>
91:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;\nTalia Digital Library system. Version: #{TaliaCore::Version::STRING}&quot;</span> 
92:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;http://www.talia.discovery-project.eu/\n\n&quot;</span>
93:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>